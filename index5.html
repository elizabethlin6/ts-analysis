<!DOCTYPE html>
<html>
<head>
  <title>EARNINGS</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    /* Add some basic styling for the tooltips */
    .tooltip {
      position: absolute;
      padding: 6px;
      background: #333;
      color: #fff;
      border-radius: 4px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>

var avgTicket = 215
    var percStadiumFilled = 0.5
    var fees = 1 - 0.1
    var takeHomeValue = avgTicket * fees

    // Example hardcoded data
    const data = [
        { "date": "2023-03-18", "stadium": "State Farm Stadium", "name": "Glendale, AZ", "population": 196512, "days": 2, "seats": 157200 },
        { "date": "2023-03-25", "stadium": "Allegiant Stadium", "name": "Las Vegas, NV", "population": 2150373, "days": 2, "seats": 143670 },
        { "date": "2023-04-02", "stadium": "AT&T Stadium", "name": "Arlington, TX", "population": 392304, "days": 3, "seats": 315000 },
        { "date": "2023-04-15", "stadium": "Raymond James Stadium", "name": "Tampa, FL", "population": 2683956, "days": 3, "seats": 225000 },
        { "date": "2023-04-23", "stadium": "NRG Stadium", "name": "Houston, TX", "population": 5650910, "days": 3, "seats": 240000 },
        { "date": "2023-04-30", "stadium": "Mercedes-Benz Stadium", "name": "Atlanta, GA", "population": 5046555, "days": 3, "seats": 225000 },
        { "date": "2023-05-07", "stadium": "Nissan Stadium", "name": "Nashville, TN", "population": 1098486, "days": 3, "seats": 207429 },
        { "date": "2023-05-14", "stadium": "Lincoln Financial Field", "name": "Philadelphia, PA", "population": 5512873, "days": 3, "seats": 209688 },
        { "date": "2023-05-21", "stadium": "Gillette Stadium", "name": "Foxborough, MA", "population": 16693, "days": 3, "seats": 197634 },
        { "date": "2023-05-28", "stadium": "MetLife Stadium", "name": "East Rutherford, NJ", "population": 9918, "days": 3, "seats": 265473 },
        { "date": "2023-06-04", "stadium": "Soldier Field", "name": "Chicago, IL", "population": 4576, "days": 3, "seats": 184500 },
        { "date": "2023-06-10", "stadium": "Ford Field", "name": "Detroit, MI", "population": 3522856, "days": 2, "seats": 156000 },
        { "date": "2023-06-17", "stadium": "Acrisure Stadium", "name": "Pittsburgh, PA", "population": 1720279, "days": 2, "seats": 150000 },
        { "date": "2023-06-24", "stadium": "U.S. Bank Stadium", "name": "Minneapolis, MN", "population": 2856952, "days": 2, "seats": 146000 },
        { "date": "2023-07-01", "stadium": "Paycor Stadium", "name": "Cincinnati, OH", "population": 1712287, "days": 2, "seats": 131030 },
        { "date": "2023-07-08", "stadium": "GEHA Field", "name": "Kansas City, MO", "population": 155745, "days": 2, "seats": 152832 },
        { "date": "2023-07-15", "stadium": "Empower Field", "name": "Denver, CO", "population": 2650725, "days": 2, "seats": 168000 },
        { "date": "2023-07-23", "stadium": "Lumen Field", "name": "Seattle, WA", "population": 3438221, "days": 2, "seats": 144000 },
        { "date": "2023-07-29", "stadium": "Levi's Stadium", "name": "Santa Clara, CA", "population": 127922, "days": 2, "seats": 137000 },
        { "date": "2023-08-09", "stadium": "Sofi Stadium", "name": "Los Angeles, CA", "population": 12121244, "days": 6, "seats": 501200 }
      ];

    // Sort the data by date in ascending order
    data.sort((a, b) => new Date(a.date) - new Date(b.date));

    // Calculate the cumulative sum of seats
    var rollingRevenue = 0
    data.forEach((entry) => {
      currentRevenue = Math.round(entry.seats * percStadiumFilled * entry.days * takeHomeValue / 1000000)
      rollingRevenue += currentRevenue
      entry.showrevenue = currentRevenue
      entry.revenue = rollingRevenue
    });

    console.log(data); // Output the data with the new revenue attribute

    // Set up the SVG dimensions
    const margin = { top: 20, right: 30, bottom: 30, left: 50 };
    const width = 1200 - margin.left - margin.right;
    const height = 500 - margin.top - margin.bottom;

    // Parse the date format
    const parseDate = d3.timeParse('%Y-%m-%d');

    // Set up the scales
    const x = d3.scaleTime().range([0, width]);
    const y = d3.scaleLinear().range([height, 0]);

    // Define the line function
    const line = d3.line()
      .x(d => x(d.date))
      .y(d => y(d.revenue));

    // Create the SVG element
    const svg = d3.select('#chart')
      .append('svg')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
      .append('g')
      .attr('transform', `translate(${margin.left}, ${margin.top})`);

    // Convert date strings to date objects
    data.forEach(d => {
      d.date = parseDate(d.date);
      d.revenue = +d.revenue;
    });

    // Set the domains for the scales
    x.domain(d3.extent(data, d => d.date));
    y.domain([0, d3.max(data, d => d.revenue)]);

    // Add the X-axis
    svg.append('g')
      .attr('transform', `translate(0, ${height})`)
      .call(d3.axisBottom(x));

    // Add the Y-axis
    svg.append('g')
      .call(d3.axisLeft(y));

    // Add the line
    svg.append('path')
      .datum(data)
      .attr('fill', 'none')
      .attr('stroke', 'steelblue')
      .attr('stroke-width', 2)
      .attr('d', line);

    // Add the scatter plot points with tooltips
    svg.selectAll('.dot')
      .data(data)
      .enter()
      .append('circle')
      .attr('class', 'dot')
      .attr('cx', d => x(d.date))
      .attr('cy', d => y(d.revenue))
      .attr('r', 5) // Adjust the radius as needed
      .attr('fill', 'steelblue')
      .on('mouseover', (event, d) => {
        // Show tooltip on mouseover
        d3.select(this).attr('fill', 'orange');

        const tooltip = d3.select('body').append('div')
          .attr('class', 'tooltip')
          .attr('fill', 'yellow')
          .style('left', `${event.pageX}px`)
          .style('top', `${event.pageY}px`)
          .html(`
          <strong>${d.stadium}</strong><br>
          <strong>Location:</strong> ${d.name}<br>
          <strong>Date:</strong> ${d.date.toDateString()}<br>
          <strong>Attendees/Day:</strong> ${Math.round(d.seats / d.days / 1000)}K<br>
          <strong>Show Revenue:</strong> $${d.showrevenue}M<br>
          <strong>Total Revenue:</strong> $${d.revenue}M`)
      })
      .on('mouseout', () => {
        // Remove tooltip on mouseout
        d3.select('.tooltip').remove();
      });
  </script>
</body>
</html>
